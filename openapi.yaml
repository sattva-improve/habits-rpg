openapi: 3.0.3
info:
  title: Habit Tracker RPG API
  description: |
    ç¿’æ…£ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆRPGè¦ç´ ä»˜ãï¼‰ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API
    
    ## æ¦‚è¦
    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆCognitoé€£æºï¼‰
    - ç¿’æ…£ã®CRUDæ“ä½œ
    - ç¿’æ…£è¨˜éŒ²ï¼ˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼‰
    - ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ãƒ¬ãƒ™ãƒ«ã€çµŒé¨“å€¤ã€ç§°å·ã€ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆï¼‰
    - çµ±è¨ˆãƒ»ãƒ¬ãƒãƒ¼ãƒˆ
    - ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®š
    
    ## ğŸš€ Amplify Sandbox ãƒ†ã‚¹ãƒˆæ–¹æ³•
    
    ç¾åœ¨ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ **AWS AppSync GraphQL API** ã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚
    
    ### GraphQL ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    ```
    https://c44kjstsh5d7rbhlw2yy7wthcu.appsync-api.us-east-1.amazonaws.com/graphql
    ```
    
    ### ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰
    
    | ãƒ„ãƒ¼ãƒ« | ä½¿ã„æ–¹ |
    |--------|--------|
    | **GraphQL Playground** | `test/graphql-playground.html` ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã |
    | **curl ãƒ†ã‚¹ãƒˆ** | `./test/curl-test.sh` ã‚’å®Ÿè¡Œ |
    | **TypeScript ãƒ†ã‚¹ãƒˆ** | `npx ts-node test/api-test.ts` ã‚’å®Ÿè¡Œ |
    
    ### API Keyï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç”¨ï¼‰
    ```
    da2-4gyvtrzdjjaf5ero4jeb3mrcvq
    ```
    
    ### èªè¨¼
    - **API Key** (`x-api-key`): Achievement, Job, CharacterSprite ã®ãƒªãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹
    - **Cognito JWT** (`Authorization: Bearer {token}`): ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å…¨æ“ä½œ
    
    ---
    
    ## èªè¨¼ï¼ˆREST APIè¨­è¨ˆï¼‰
    Amazon Cognito JWTèªè¨¼ã‚’ä½¿ç”¨
    
    ã™ã¹ã¦ã®APIï¼ˆ`/auth/*` ã‚’é™¤ãï¼‰ã¯èªè¨¼ãŒå¿…è¦ã§ã™ã€‚
    ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã« `Authorization: Bearer {access_token}` ã‚’å«ã‚ã¦ãã ã•ã„ã€‚
    
    ## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚·ã‚¹ãƒ†ãƒ 
    | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ç•¥ç§° | é–¢é€£ã‚«ãƒ†ã‚´ãƒª |
    |-----------|------|--------------|
    | ä½“åŠ› (Vitality) | VIT | é‹å‹•ã€ç¡çœ ã€å¥åº· |
    | çŸ¥åŠ› (Intelligence) | INT | èª­æ›¸ã€å‹‰å¼·ã€å­¦ç¿’ |
    | ç²¾ç¥ (Mental) | MND | ç‘æƒ³ã€æ—¥è¨˜ã€æ„Ÿè¬ã€ãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹ |
    | å™¨ç”¨ (Dexterity) | DEX | éŸ³æ¥½ã€ã‚¢ãƒ¼ãƒˆã€ã‚¯ãƒ©ãƒ•ãƒˆã€è¶£å‘³ |
    | é­…åŠ› (Charisma) | CHA | ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ç¤¾äº¤ã€èº«ã ã—ãªã¿ |
    | ç­‹åŠ› (Strength) | STR | ç­‹ãƒˆãƒ¬ã€ã‚¹ãƒãƒ¼ãƒ„ã€ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ |
    
    ## çµŒé¨“å€¤ãƒ»ãƒ¬ãƒ™ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ60æ—¥ã‚«ãƒ³ã‚¹ãƒˆè¨­è¨ˆï¼‰
    - åŸºæœ¬çµŒé¨“å€¤: 15 EXP
    - é›£æ˜“åº¦ãƒœãƒ¼ãƒŠã‚¹: Easy(0.5x), Normal(1.0x), Hard(1.5x), VeryHard(2.0x)
    - ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒœãƒ¼ãƒŠã‚¹: 3æ—¥(1.1x), 7æ—¥(1.25x), 14æ—¥(1.5x), 30æ—¥(2.0x), 60æ—¥(2.5x)
    - ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—è¨ˆç®—: å¿…è¦EXP = 15 Ã— (1.02 ^ (level - 1))
    - ã‚«ãƒ³ã‚¹ãƒˆç›®å®‰: 1æ—¥3ç¿’æ…£(Normal)ã§59æ—¥ç›®ã«Lv.99åˆ°é”
  version: 1.0.0
  contact:
    name: API Support
    
servers:
  - url: https://api.habit-tracker-rpg.example.com/v1
    description: Production server (REST API - æœªå®Ÿè£…)
  - url: https://c44kjstsh5d7rbhlw2yy7wthcu.appsync-api.us-east-1.amazonaws.com
    description: Amplify Sandbox (GraphQL API)
    variables:
      basePath:
        default: graphql
        description: GraphQL endpoint path

tags:
  - name: Auth
    description: èªè¨¼é–¢é€£
  - name: Users
    description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
  - name: Habits
    description: ç¿’æ…£ç®¡ç†
  - name: Records
    description: ç¿’æ…£è¨˜éŒ²
  - name: Stats
    description: çµ±è¨ˆãƒ»ãƒ¬ãƒãƒ¼ãƒˆ
  - name: Gamification
    description: ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¬ãƒ™ãƒ«ã€çµŒé¨“å€¤ï¼‰
  - name: Achievements
    description: ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆ
  - name: Jobs
    description: ç§°å·ãƒ»ã‚¸ãƒ§ãƒ–
  - name: Reminders
    description: ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
  - name: GraphQL
    description: |
      AWS AppSync GraphQL APIï¼ˆAmplify Sandboxãƒ†ã‚¹ãƒˆç”¨ï¼‰
      
      ## ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
      `https://c44kjstsh5d7rbhlw2yy7wthcu.appsync-api.us-east-1.amazonaws.com/graphql`
      
      ## èªè¨¼æ–¹æ³•
      - **API Key** (`x-api-key`): ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆAchievement, Job, CharacterSpriteï¼‰ã®ãƒªãƒ¼ãƒ‰
      - **Cognito JWT** (`Authorization: Bearer {token}`): ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®ãƒ‡ãƒ¼ã‚¿æ“ä½œ
      
      ## ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«
      - GraphQL Playground: `test/graphql-playground.html`
      - curl ãƒ†ã‚¹ãƒˆ: `./test/curl-test.sh`

paths:
  # ========== GraphQL API (Amplify Sandbox) ==========
  /graphql:
    post:
      tags: [GraphQL]
      summary: GraphQL API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
      operationId: graphqlQuery
      description: |
        AWS AppSync GraphQL API ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        
        **ã‚µãƒ¼ãƒãƒ¼**: https://c44kjstsh5d7rbhlw2yy7wthcu.appsync-api.us-east-1.amazonaws.com/graphql
        
        **æ³¨æ„**: Swagger UIã§ã¯GraphQL APIã®ãƒ†ã‚¹ãƒˆãŒå›°é›£ãªãŸã‚ã€ä»¥ä¸‹ã‚’æ¨å¥¨ã—ã¾ã™ï¼š
        - ãƒ–ãƒ©ã‚¦ã‚¶: `test/graphql-playground.html` ã‚’é–‹ã
        - ã‚¿ãƒ¼ãƒŸãƒŠãƒ«: `./test/curl-test.sh` ã‚’å®Ÿè¡Œ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphQLRequest'
            examples:
              listAchievements:
                summary: ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆä¸€è¦§å–å¾—
                value:
                  query: "query { listAchievements { items { achievementId name description type rarity expReward isHidden } } }"
              listJobs:
                summary: ã‚¸ãƒ§ãƒ–ä¸€è¦§å–å¾—
                value:
                  query: "query { listJobs { items { jobId name description tier expBonus } } }"
              listCharacterSprites:
                summary: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆä¸€è¦§å–å¾—
                value:
                  query: "query { listCharacterSprites { items { spriteId name description category isDefault } } }"
              schemaIntrospection:
                summary: ã‚¹ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆãƒ­ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³
                value:
                  query: "{ __schema { types { name kind } } }"
      responses:
        '200':
          description: GraphQL ãƒ¬ã‚¹ãƒãƒ³ã‚¹
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphQLResponse'
              examples:
                successResponse:
                  value:
                    data:
                      listAchievements:
                        items: []
                errorResponse:
                  value:
                    data: null
                    errors:
                      - message: "Not Authorized to access listUsers on type Query"
                        errorType: "Unauthorized"
        '400':
          description: GraphQL ã‚¨ãƒ©ãƒ¼
        '401':
          description: èªè¨¼ã‚¨ãƒ©ãƒ¼
      security:
        - apiKeyAuth: []
        - bearerAuth: []

  # ========== Auth ==========
  /auth/signup:
    post:
      tags: [Auth]
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
      operationId: signUp
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
            example:
              email: "test@example.com"
              password: "SecurePass123!"
              display_name: "ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼"
              timezone: "Asia/Tokyo"
      responses:
        '201':
          description: ç™»éŒ²æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                message: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ"
                user_id: "01HRQX8K4MZJP7Y9GF2D5N3B6C"
                user:
                  user_id: "01HRQX8K4MZJP7Y9GF2D5N3B6C"
                  email: "test@example.com"
                  profile:
                    display_name: "ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼"
                    timezone: "Asia/Tokyo"
                  stats:
                    vitality: 1
                    intelligence: 1
                    mental: 1
                    dexterity: 1
                    charisma: 1
                    strength: 1
                  level: 1
                  total_exp: 0
                  current_job_id: "beginner"
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'

  /auth/signin:
    post:
      tags: [Auth]
      summary: ãƒ­ã‚°ã‚¤ãƒ³
      operationId: signIn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignInRequest'
            example:
              email: "test@example.com"
              password: "SecurePass123!"
      responses:
        '200':
          description: ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                access_token: "eyJraWQiOiJhYmNkZWYxMjM0NTY3ODkwIiwiYWxnIjoiUlMyNTYifQ..."
                refresh_token: "eyJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAifQ..."
                expires_in: 3600
                token_type: "Bearer"
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/signout:
    post:
      tags: [Auth]
      summary: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
      operationId: signOut
      security:
        - bearerAuth: []
      responses:
        '204':
          description: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæˆåŠŸ
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/password/change:
    post:
      tags: [Auth]
      summary: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
      operationId: changePassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '204':
          description: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æˆåŠŸ
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========== Users ==========
  /users/me:
    get:
      tags: [Users]
      summary: è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
      operationId: getMyProfile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
    
    put:
      tags: [Users]
      summary: è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
      operationId: updateMyProfile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdateRequest'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /users/me/stats:
    get:
      tags: [Users, Gamification]
      summary: è‡ªåˆ†ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—
      operationId: getMyStats
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserStats'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========== Habits ==========
  /habits:
    get:
      tags: [Habits]
      summary: ç¿’æ…£ä¸€è¦§å–å¾—
      operationId: listHabits
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/HabitCategory'
        - name: is_active
          in: query
          schema:
            type: boolean
            default: true
        - name: is_archived
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  habits:
                    type: array
                    items:
                      $ref: '#/components/schemas/Habit'
                  total:
                    type: integer
              example:
                habits:
                  - habit_id: "01HRQY5K4MZJP7Y9GF2D5N3B6C"
                    user_id: "01HRQX8K4MZJP7Y9GF2D5N3B6C"
                    name: "æœã®ã‚¸ãƒ§ã‚®ãƒ³ã‚°"
                    description: "æ¯æœ30åˆ†ã®ã‚¸ãƒ§ã‚®ãƒ³ã‚°ã‚’ã™ã‚‹"
                    icon: "ğŸƒ"
                    color: "#4CAF50"
                    category: "exercise"
                    stat_type: "VIT"
                    frequency:
                      type: "daily"
                    difficulty: "normal"
                    current_streak: 7
                    best_streak: 14
                    total_completions: 45
                    is_active: true
                    is_archived: false
                  - habit_id: "01HRQY6K4MZJP7Y9GF2D5N3B6D"
                    user_id: "01HRQX8K4MZJP7Y9GF2D5N3B6C"
                    name: "ç­‹ãƒˆãƒ¬"
                    description: "é€±3å›ã®ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°"
                    icon: "ğŸ’ª"
                    color: "#FF5722"
                    category: "workout"
                    stat_type: "STR"
                    frequency:
                      type: "specific_days"
                      specific_days: [0, 2, 4]
                    difficulty: "hard"
                    current_streak: 3
                    best_streak: 8
                    is_active: true
                    is_archived: false
                total: 2
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Habits]
      summary: ç¿’æ…£ä½œæˆ
      operationId: createHabit
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HabitCreateRequest'
            example:
              name: "èª­æ›¸"
              description: "æ¯æ—¥30åˆ†ã®èª­æ›¸"
              icon: "ğŸ“š"
              color: "#2196F3"
              category: "reading"
              frequency:
                type: "daily"
              difficulty: "normal"
              reminder_enabled: true
              reminder_time: "21:00:00"
      responses:
        '201':
          description: ä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Habit'
              example:
                habit_id: "01HRQZ7K4MZJP7Y9GF2D5N3B6E"
                user_id: "01HRQX8K4MZJP7Y9GF2D5N3B6C"
                name: "èª­æ›¸"
                description: "æ¯æ—¥30åˆ†ã®èª­æ›¸"
                icon: "ğŸ“š"
                color: "#2196F3"
                category: "reading"
                stat_type: "INT"
                frequency:
                  type: "daily"
                difficulty: "normal"
                reminder_enabled: true
                reminder_time: "21:00:00"
                current_streak: 0
                best_streak: 0
                total_completions: 0
                is_active: true
                is_archived: false
                created_at: "2026-01-08T10:00:00.000000"
                updated_at: "2026-01-08T10:00:00.000000"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /habits/{habitId}:
    parameters:
      - name: habitId
        in: path
        required: true
        schema:
          type: string
    
    get:
      tags: [Habits]
      summary: ç¿’æ…£è©³ç´°å–å¾—
      operationId: getHabit
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Habit'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Habits]
      summary: ç¿’æ…£æ›´æ–°
      operationId: updateHabit
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HabitUpdateRequest'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Habit'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Habits]
      summary: ç¿’æ…£å‰Šé™¤
      operationId: deleteHabit
      security:
        - bearerAuth: []
      responses:
        '204':
          description: å‰Šé™¤æˆåŠŸ
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /habits/{habitId}/archive:
    parameters:
      - name: habitId
        in: path
        required: true
        schema:
          type: string
    
    post:
      tags: [Habits]
      summary: ç¿’æ…£ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
      operationId: archiveHabit
      security:
        - bearerAuth: []
      responses:
        '200':
          description: ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Habit'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ========== Records ==========
  /habits/{habitId}/records:
    parameters:
      - name: habitId
        in: path
        required: true
        schema:
          type: string

    get:
      tags: [Records]
      summary: ç¿’æ…£è¨˜éŒ²ä¸€è¦§å–å¾—
      operationId: listHabitRecords
      security:
        - bearerAuth: []
      parameters:
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  records:
                    type: array
                    items:
                      $ref: '#/components/schemas/HabitRecord'
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags: [Records]
      summary: ç¿’æ…£é”æˆã‚’è¨˜éŒ²
      operationId: createHabitRecord
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HabitRecordCreateRequest'
            example:
              completed_date: "2026-01-08"
              completed: true
              note: "æœã‹ã‚‰æ°—æŒã¡ã‚ˆãèµ°ã‚ŒãŸï¼"
      responses:
        '201':
          description: è¨˜éŒ²æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitRecordResponse'
              examples:
                normal:
                  summary: é€šå¸¸ã®è¨˜éŒ²
                  value:
                    record:
                      record_id: "01HRR15K4MZJP7Y9GF2D5N3B6F"
                      habit_id: "01HRQY5K4MZJP7Y9GF2D5N3B6C"
                      user_id: "01HRQX8K4MZJP7Y9GF2D5N3B6C"
                      completed_date: "2026-01-08"
                      completed: true
                      note: "æœã‹ã‚‰æ°—æŒã¡ã‚ˆãèµ°ã‚ŒãŸï¼"
                      exp_earned: 12
                      streak_at_completion: 8
                    exp_gained: 12
                    new_streak: 8
                    level_up: false
                    stat_level_up: false
                    stat_type: "VIT"
                    new_achievements: []
                    new_jobs: []
                with_achievement:
                  summary: ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆè§£é™¤
                  value:
                    record:
                      record_id: "01HRR15K4MZJP7Y9GF2D5N3B6F"
                      habit_id: "01HRQY5K4MZJP7Y9GF2D5N3B6C"
                      user_id: "01HRQX8K4MZJP7Y9GF2D5N3B6C"
                      completed_date: "2026-01-08"
                      completed: true
                      note: "7æ—¥é€£ç¶šé”æˆï¼"
                      exp_earned: 12
                      streak_at_completion: 7
                    exp_gained: 12
                    new_streak: 7
                    level_up: true
                    new_level: 9
                    stat_level_up: true
                    new_stat_level: 6
                    stat_type: "VIT"
                    new_achievements:
                      - achievement_id: "streak_7"
                        name: "ä¸€é€±é–“ã®ç¿’æ…£"
                        description: "7æ—¥é€£ç¶šã§ç¿’æ…£ã‚’é”æˆã™ã‚‹"
                        icon: "ğŸ”¥"
                        type: "streak"
                        rarity: "uncommon"
                        exp_reward: 100
                    new_jobs: []
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /habits/{habitId}/records/{recordId}:
    parameters:
      - name: habitId
        in: path
        required: true
        schema:
          type: string
      - name: recordId
        in: path
        required: true
        schema:
          type: string

    put:
      tags: [Records]
      summary: ç¿’æ…£è¨˜éŒ²æ›´æ–°
      operationId: updateHabitRecord
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HabitRecordUpdateRequest'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitRecord'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Records]
      summary: ç¿’æ…£è¨˜éŒ²å‰Šé™¤
      operationId: deleteHabitRecord
      security:
        - bearerAuth: []
      responses:
        '204':
          description: å‰Šé™¤æˆåŠŸ
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /records/today:
    get:
      tags: [Records]
      summary: ä»Šæ—¥ã®è¨˜éŒ²ä¸€è¦§å–å¾—
      operationId: getTodayRecords
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodayRecordsResponse'
              example:
                date: "2026-01-08"
                habits:
                  - habit:
                      habit_id: "01HRQY5K4MZJP7Y9GF2D5N3B6C"
                      name: "æœã®ã‚¸ãƒ§ã‚®ãƒ³ã‚°"
                      icon: "ğŸƒ"
                      category: "exercise"
                    record:
                      record_id: "01HRR15K4MZJP7Y9GF2D5N3B6F"
                      completed: true
                      exp_earned: 12
                    is_due_today: true
                  - habit:
                      habit_id: "01HRQZ7K4MZJP7Y9GF2D5N3B6E"
                      name: "èª­æ›¸"
                      icon: "ğŸ“š"
                      category: "reading"
                    record: null
                    is_due_today: true
                completed_count: 1
                total_due: 2
                completion_rate: 0.5
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========== Stats ==========
  /stats/daily:
    get:
      tags: [Stats]
      summary: æ—¥æ¬¡çµ±è¨ˆå–å¾—
      operationId: getDailyStats
      security:
        - bearerAuth: []
      parameters:
        - name: date
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DailyStats'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /stats/weekly:
    get:
      tags: [Stats]
      summary: é€±æ¬¡çµ±è¨ˆå–å¾—
      operationId: getWeeklyStats
      security:
        - bearerAuth: []
      parameters:
        - name: week_start
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeeklyStats'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /stats/monthly:
    get:
      tags: [Stats]
      summary: æœˆæ¬¡çµ±è¨ˆå–å¾—
      operationId: getMonthlyStats
      security:
        - bearerAuth: []
      parameters:
        - name: year
          in: query
          required: true
          schema:
            type: integer
        - name: month
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 12
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonthlyStats'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========== Achievements ==========
  /achievements:
    get:
      tags: [Achievements]
      summary: ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆä¸€è¦§å–å¾—
      operationId: listAchievements
      security:
        - bearerAuth: []
      parameters:
        - name: include_locked
          in: query
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  achievements:
                    type: array
                    items:
                      $ref: '#/components/schemas/AchievementProgress'
                  unlocked_count:
                    type: integer
                  total_count:
                    type: integer
              example:
                achievements:
                  - achievement_id: "first_habit"
                    achievement:
                      achievement_id: "first_habit"
                      name: "æœ€åˆã®ç¿’æ…£"
                      description: "æœ€åˆã®ç¿’æ…£ã‚’ä½œæˆã™ã‚‹"
                      icon: "ğŸ‰"
                      type: "first"
                      rarity: "common"
                      exp_reward: 20
                    is_unlocked: true
                    unlocked_at: "2026-01-01T00:00:00.000000"
                    current_value: 1
                    target_value: 1
                    progress_percent: 100.0
                  - achievement_id: "streak_7"
                    achievement:
                      achievement_id: "streak_7"
                      name: "ä¸€é€±é–“ã®ç¿’æ…£"
                      description: "7æ—¥é€£ç¶šã§ç¿’æ…£ã‚’é”æˆã™ã‚‹"
                      icon: "ğŸ”¥"
                      type: "streak"
                      rarity: "uncommon"
                      exp_reward: 100
                    is_unlocked: true
                    unlocked_at: "2026-01-08T06:35:00.000000"
                    current_value: 7
                    target_value: 7
                    progress_percent: 100.0
                  - achievement_id: "streak_30"
                    achievement:
                      achievement_id: "streak_30"
                      name: "æœˆé–“ãƒã‚¹ã‚¿ãƒ¼"
                      description: "30æ—¥é€£ç¶šã§ç¿’æ…£ã‚’é”æˆã™ã‚‹"
                      icon: "ğŸ”¥"
                      type: "streak"
                      rarity: "rare"
                      exp_reward: 500
                    is_unlocked: false
                    current_value: 7
                    target_value: 30
                    progress_percent: 23.3
                unlocked_count: 2
                total_count: 3
        '401':
          $ref: '#/components/responses/Unauthorized'

  /achievements/{achievementId}:
    parameters:
      - name: achievementId
        in: path
        required: true
        schema:
          type: string

    get:
      tags: [Achievements]
      summary: ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆè©³ç´°å–å¾—
      operationId: getAchievement
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AchievementProgress'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ========== Jobs ==========
  /jobs:
    get:
      tags: [Jobs]
      summary: ã‚¸ãƒ§ãƒ–ä¸€è¦§å–å¾—
      operationId: listJobs
      security:
        - bearerAuth: []
      parameters:
        - name: include_locked
          in: query
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/JobProgress'
                  unlocked_count:
                    type: integer
                  total_count:
                    type: integer
              example:
                jobs:
                  - job_id: "beginner"
                    job:
                      job_id: "beginner"
                      name: "ãƒ“ã‚®ãƒŠãƒ¼"
                      description: "ã™ã¹ã¦ã®å†’é™ºè€…ã®å§‹ã¾ã‚Š"
                      icon: "ğŸŒ±"
                      tier: "novice"
                      requirements: {}
                      stat_bonuses: {}
                      exp_bonus: 1.0
                    is_unlocked: true
                    is_equipped: false
                    unlocked_at: "2026-01-01T00:00:00.000000"
                  - job_id: "warrior_apprentice"
                    job:
                      job_id: "warrior_apprentice"
                      name: "è¦‹ç¿’ã„æˆ¦å£«"
                      description: "ç­‹åŠ›ã‚’é›ãˆã‚‹è€…"
                      icon: "âš”ï¸"
                      tier: "apprentice"
                      requirements:
                        stats:
                          STR: 5
                      stat_bonuses:
                        STR: 1
                      exp_bonus: 1.05
                    is_unlocked: true
                    is_equipped: true
                    unlocked_at: "2026-01-05T10:00:00.000000"
                    requirements_met:
                      stat_STR: true
                    progress_details:
                      stats:
                        STR:
                          current: 6
                          required: 5
                unlocked_count: 2
                total_count: 2
        '401':
          $ref: '#/components/responses/Unauthorized'

  /jobs/{jobId}:
    parameters:
      - name: jobId
        in: path
        required: true
        schema:
          type: string

    get:
      tags: [Jobs]
      summary: ã‚¸ãƒ§ãƒ–è©³ç´°å–å¾—
      operationId: getJob
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobProgress'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /jobs/{jobId}/equip:
    parameters:
      - name: jobId
        in: path
        required: true
        schema:
          type: string

    post:
      tags: [Jobs]
      summary: ã‚¸ãƒ§ãƒ–ã‚’è£…å‚™
      operationId: equipJob
      security:
        - bearerAuth: []
      responses:
        '200':
          description: è£…å‚™æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ========== Reminders ==========
  /reminders:
    get:
      tags: [Reminders]
      summary: ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®šä¸€è¦§å–å¾—
      operationId: listReminders
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  reminders:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReminderSetting'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /reminders/{habitId}:
    parameters:
      - name: habitId
        in: path
        required: true
        schema:
          type: string

    put:
      tags: [Reminders]
      summary: ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®šæ›´æ–°
      operationId: updateReminder
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReminderUpdateRequest'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReminderSetting'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Cognito JWT token (ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ç”¨)
    apiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: |
        AppSync API Key (ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ç”¨)
        
        **Sandbox API Key**: `da2-4gyvtrzdjjaf5ero4jeb3mrcvq`

  responses:
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    # ===== GraphQL =====
    GraphQLRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: GraphQL ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—
          example: "query { listAchievements { items { achievementId name } } }"
        variables:
          type: object
          description: GraphQL å¤‰æ•°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
          additionalProperties: true
        operationName:
          type: string
          description: æ“ä½œåï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    
    GraphQLResponse:
      type: object
      properties:
        data:
          type: object
          description: ã‚¯ã‚¨ãƒªçµæœ
          additionalProperties: true
        errors:
          type: array
          description: ã‚¨ãƒ©ãƒ¼é…åˆ—ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
          items:
            $ref: '#/components/schemas/GraphQLError'
    
    GraphQLError:
      type: object
      properties:
        message:
          type: string
          description: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        errorType:
          type: string
          description: ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—
        path:
          type: array
          items:
            type: string
          description: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ‘ã‚¹
        locations:
          type: array
          items:
            type: object
            properties:
              line:
                type: integer
              column:
                type: integer

    # ===== Error =====
    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object

    # ===== Auth =====
    SignUpRequest:
      type: object
      required:
        - email
        - password
        - display_name
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        display_name:
          type: string
          minLength: 1
          maxLength: 50
        timezone:
          type: string
          default: Asia/Tokyo

    SignInRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    RefreshTokenRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string

    ChangePasswordRequest:
      type: object
      required:
        - current_password
        - new_password
      properties:
        current_password:
          type: string
        new_password:
          type: string
          minLength: 8

    AuthResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        expires_in:
          type: integer
        token_type:
          type: string
          default: Bearer
        user:
          $ref: '#/components/schemas/User'

    # ===== User =====
    User:
      type: object
      properties:
        user_id:
          type: string
        email:
          type: string
          format: email
        profile:
          $ref: '#/components/schemas/UserProfile'
        stats:
          $ref: '#/components/schemas/UserStats'
        level:
          type: integer
          minimum: 1
        total_exp:
          type: integer
          minimum: 0
        exp_to_next_level:
          type: integer
        current_job:
          $ref: '#/components/schemas/Job'
        max_streak:
          type: integer
        current_streak:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UserProfile:
      type: object
      properties:
        display_name:
          type: string
        avatar_url:
          type: string
        bio:
          type: string
        timezone:
          type: string

    UserStats:
      type: object
      properties:
        vitality:
          type: integer
          description: ä½“åŠ› (VIT)
        vitality_exp:
          type: integer
        vitality_next_level_exp:
          type: integer
        intelligence:
          type: integer
          description: çŸ¥åŠ› (INT)
        intelligence_exp:
          type: integer
        intelligence_next_level_exp:
          type: integer
        mental:
          type: integer
          description: ç²¾ç¥åŠ› (MND)
        mental_exp:
          type: integer
        mental_next_level_exp:
          type: integer
        dexterity:
          type: integer
          description: å™¨ç”¨ã• (DEX)
        dexterity_exp:
          type: integer
        dexterity_next_level_exp:
          type: integer
        charisma:
          type: integer
          description: é­…åŠ› (CHA)
        charisma_exp:
          type: integer
        charisma_next_level_exp:
          type: integer
        strength:
          type: integer
          description: ç­‹åŠ› (STR)
        strength_exp:
          type: integer
        strength_next_level_exp:
          type: integer

    UserUpdateRequest:
      type: object
      properties:
        display_name:
          type: string
          minLength: 1
          maxLength: 50
        avatar_url:
          type: string
        bio:
          type: string
          maxLength: 500
        timezone:
          type: string

    # ===== Habit =====
    HabitCategory:
      type: string
      enum:
        - exercise
        - sleep
        - health
        - reading
        - study
        - learning
        - meditation
        - journaling
        - gratitude
        - mindfulness
        - music
        - art
        - craft
        - hobby
        - communication
        - social
        - grooming
        - workout
        - sports
        - fitness
        - other

    FrequencyType:
      type: string
      enum:
        - daily
        - weekly
        - specific_days

    HabitFrequency:
      type: object
      properties:
        type:
          $ref: '#/components/schemas/FrequencyType'
        times_per_week:
          type: integer
          minimum: 1
          maximum: 7
        specific_days:
          type: array
          items:
            type: integer
            minimum: 0
            maximum: 6

    HabitDifficulty:
      type: string
      enum:
        - easy
        - normal
        - hard
        - very_hard

    Habit:
      type: object
      properties:
        habit_id:
          type: string
        user_id:
          type: string
        name:
          type: string
        description:
          type: string
        icon:
          type: string
        color:
          type: string
        category:
          $ref: '#/components/schemas/HabitCategory'
        stat_type:
          $ref: '#/components/schemas/StatType'
        frequency:
          $ref: '#/components/schemas/HabitFrequency'
        difficulty:
          $ref: '#/components/schemas/HabitDifficulty'
        reminder_enabled:
          type: boolean
        reminder_time:
          type: string
          format: time
        current_streak:
          type: integer
        best_streak:
          type: integer
        total_completions:
          type: integer
        is_active:
          type: boolean
        is_archived:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        last_completed_at:
          type: string
          format: date-time

    HabitCreateRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        description:
          type: string
          maxLength: 500
        icon:
          type: string
          default: "ğŸ“"
        color:
          type: string
          default: "#4CAF50"
        category:
          $ref: '#/components/schemas/HabitCategory'
        frequency:
          $ref: '#/components/schemas/HabitFrequency'
        difficulty:
          $ref: '#/components/schemas/HabitDifficulty'
        reminder_enabled:
          type: boolean
          default: false
        reminder_time:
          type: string
          format: time

    HabitUpdateRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        description:
          type: string
          maxLength: 500
        icon:
          type: string
        color:
          type: string
        category:
          $ref: '#/components/schemas/HabitCategory'
        frequency:
          $ref: '#/components/schemas/HabitFrequency'
        difficulty:
          $ref: '#/components/schemas/HabitDifficulty'
        reminder_enabled:
          type: boolean
        reminder_time:
          type: string
          format: time
        is_active:
          type: boolean
        is_archived:
          type: boolean

    # ===== Record =====
    HabitRecord:
      type: object
      properties:
        record_id:
          type: string
        habit_id:
          type: string
        user_id:
          type: string
        completed_date:
          type: string
          format: date
        completed:
          type: boolean
        note:
          type: string
        exp_earned:
          type: integer
        streak_at_completion:
          type: integer
        created_at:
          type: string
          format: date-time

    HabitRecordCreateRequest:
      type: object
      required:
        - completed_date
      properties:
        completed_date:
          type: string
          format: date
        completed:
          type: boolean
          default: true
        note:
          type: string
          maxLength: 500

    HabitRecordUpdateRequest:
      type: object
      properties:
        completed:
          type: boolean
        note:
          type: string
          maxLength: 500

    HabitRecordResponse:
      type: object
      properties:
        record:
          $ref: '#/components/schemas/HabitRecord'
        exp_gained:
          type: integer
        new_streak:
          type: integer
        level_up:
          type: boolean
        new_level:
          type: integer
        stat_level_up:
          type: boolean
        new_stat_level:
          type: integer
        stat_type:
          $ref: '#/components/schemas/StatType'
        new_achievements:
          type: array
          items:
            $ref: '#/components/schemas/Achievement'
        new_jobs:
          type: array
          items:
            $ref: '#/components/schemas/Job'

    TodayRecordsResponse:
      type: object
      properties:
        date:
          type: string
          format: date
        habits:
          type: array
          items:
            type: object
            properties:
              habit:
                $ref: '#/components/schemas/Habit'
              record:
                $ref: '#/components/schemas/HabitRecord'
              is_due_today:
                type: boolean
        completed_count:
          type: integer
        total_due:
          type: integer
        completion_rate:
          type: number

    # ===== Stats =====
    DailyStats:
      type: object
      properties:
        date:
          type: string
          format: date
        total_habits:
          type: integer
        completed_habits:
          type: integer
        completion_rate:
          type: number
        total_exp_earned:
          type: integer
        habit_completions:
          type: array
          items:
            type: object
            properties:
              habit_id:
                type: string
              habit_name:
                type: string
              completed:
                type: boolean
              exp_earned:
                type: integer

    WeeklyStats:
      type: object
      properties:
        week_start:
          type: string
          format: date
        week_end:
          type: string
          format: date
        total_habits:
          type: integer
        completed_habits:
          type: integer
        completion_rate:
          type: number
        total_exp_earned:
          type: integer
        daily_stats:
          type: array
          items:
            $ref: '#/components/schemas/DailyStats'

    MonthlyStats:
      type: object
      properties:
        year:
          type: integer
        month:
          type: integer
        total_habits:
          type: integer
        completed_habits:
          type: integer
        completion_rate:
          type: number
        total_exp_earned:
          type: integer
        weekly_stats:
          type: array
          items:
            $ref: '#/components/schemas/WeeklyStats'

    # ===== Gamification =====
    StatType:
      type: string
      enum:
        - VIT
        - INT
        - MND
        - DEX
        - CHA
        - STR

    # ===== Achievement =====
    AchievementType:
      type: string
      enum:
        - streak
        - total
        - level
        - stat
        - special
        - first

    AchievementRarity:
      type: string
      enum:
        - common
        - uncommon
        - rare
        - epic
        - legendary

    Achievement:
      type: object
      properties:
        achievement_id:
          type: string
        name:
          type: string
        description:
          type: string
        icon:
          type: string
        type:
          $ref: '#/components/schemas/AchievementType'
        rarity:
          $ref: '#/components/schemas/AchievementRarity'
        exp_reward:
          type: integer
        is_hidden:
          type: boolean

    AchievementProgress:
      type: object
      properties:
        achievement:
          $ref: '#/components/schemas/Achievement'
        is_unlocked:
          type: boolean
        unlocked_at:
          type: string
          format: date-time
        current_value:
          type: integer
        target_value:
          type: integer
        progress_percent:
          type: number

    # ===== Job =====
    JobTier:
      type: string
      enum:
        - novice
        - apprentice
        - journeyman
        - expert
        - master
        - grandmaster

    Job:
      type: object
      properties:
        job_id:
          type: string
        name:
          type: string
        description:
          type: string
        icon:
          type: string
        tier:
          $ref: '#/components/schemas/JobTier'
        stat_bonuses:
          type: object
          additionalProperties:
            type: integer
        exp_bonus:
          type: number

    JobProgress:
      type: object
      properties:
        job:
          $ref: '#/components/schemas/Job'
        is_unlocked:
          type: boolean
        is_equipped:
          type: boolean
        unlocked_at:
          type: string
          format: date-time
        requirements_met:
          type: object
          additionalProperties:
            type: boolean
        progress_details:
          type: object

    # ===== Reminder =====
    ReminderSetting:
      type: object
      properties:
        habit_id:
          type: string
        habit_name:
          type: string
        enabled:
          type: boolean
        reminder_time:
          type: string
          format: time

    ReminderUpdateRequest:
      type: object
      properties:
        enabled:
          type: boolean
        reminder_time:
          type: string
          format: time
