# ジョブ解放条件表示機能 - テスト手順

## 実装完了済み

### 変更ファイル
1. **新規作成**: `frontend/src/utils/jobRequirements.ts`
2. **修正**: `frontend/src/pages/Achievements.tsx`
3. **修正**: `frontend/src/types/index.ts`

### 実装内容

#### 1. 条件チェックロジック (jobRequirements.ts)
- `checkJobRequirements()`: 各条件の詳細ステータスと達成率を返す
- `getJobUnlockProgress()`: 全体の進捗率を計算
- `isJobUnlockable()`: 全条件達成判定

#### 2. UI変更 (Achievements.tsx)

**カード上の進捗バッジ**:
```tsx
{!job.isUnlocked && job.progress && (
  <div className="absolute top-1 left-1 ...">
    <span>{job.progress.percentage}%</span>
  </div>
)}
```

**Popover内のプログレスバー表示**:
- 各条件ごとにプログレスバー表示
- 達成済み: 緑色 + ✅
- 未達成: 紫色 + ❌
- 全体進捗サマリー

---

## テスト手順

### 1. 環境準備

```bash
# ターミナル1: バックエンド起動
make sandbox

# ターミナル2: フロントエンド起動
make dev

# ブラウザで http://localhost:3000 を開く
```

### 2. 基本動作確認

#### 2.1 カード表示チェック
- [ ] 実績・職業ページに遷移
- [ ] 職業タブをクリック
- [ ] 未解放のジョブカードに進捗バッジ（例: "66%"）が表示されている
- [ ] 解放済みのジョブには緑色のチェックマークが表示されている
- [ ] 装備中のジョブには黄色のチェックマークが表示されている

#### 2.2 Popover表示チェック
- [ ] 未解放のジョブカードにホバー
- [ ] Popoverが開く
- [ ] "解放条件:" セクションが表示される
- [ ] 各条件が以下の形式で表示される:
  ```
  レベル: 8 / 10 ✅ or ❌
  [プログレスバー] 80%
  ```

#### 2.3 条件別チェック

**レベル条件**:
- [ ] 現在レベルが表示される (例: "8 / 10")
- [ ] プログレスバーが正しい幅で表示される
- [ ] 達成済みの場合、緑色 + ✅
- [ ] 未達成の場合、紫色 + ❌

**ステータス条件**:
- [ ] 日本語名で表示される (例: "ちから: 3 / 5")
- [ ] 複数のステータス条件がある場合、全て表示される
- [ ] プログレスバーが各条件ごとに表示される

**前提ジョブ条件**:
- [ ] ジョブ名が表示される (例: "しょくぎょう: 見習い戦士")
- [ ] 未解放の場合: "みかいほう" + 0%
- [ ] 解放済みの場合: "かいほうずみ" + 100%

**アチーブメント条件**:
- [ ] 称号名が表示される (例: "しょうごう: 早起きマスター")
- [ ] 未解放/解放済みの表示が正しい

**全体進捗**:
- [ ] 下部に全体進捗が表示される (例: "達成: 2/3 (66%)")
- [ ] 全体プログレスバーが表示される

#### 2.4 装備中ジョブのチェック
- [ ] 装備中のジョブのPopoverに "そうびちゅう" バッジが表示される
- [ ] "そうびする" ボタンが表示されない

#### 2.5 解放済みジョブのチェック
- [ ] 解放条件セクションが表示されない
- [ ] "そうびする" ボタンが表示される (装備中でない場合)
- [ ] ボタンクリックで装備変更できる

### 3. エッジケースチェック

#### 3.1 条件なしジョブ (beginner)
- [ ] "ビギナー" は常に解放済み
- [ ] 進捗バッジが表示されない
- [ ] Popoverに解放条件が表示されない

#### 3.2 100%超えの条件
- [ ] レベルや能力値が必要値を超えている場合
- [ ] プログレスバーが100%で止まる (120%などにならない)
- [ ] "12 / 10" のように現在値が表示される

#### 3.3 複数条件の組み合わせ
- [ ] レベル + ステータス + ジョブの組み合わせ
- [ ] 全て正しく表示される
- [ ] 全体進捗が正しく計算される

### 4. レスポンシブチェック

- [ ] デスクトップ表示 (1920x1080)
- [ ] タブレット表示 (768x1024)
- [ ] モバイル表示 (375x667)
- [ ] グリッドレイアウトが適切に調整される

### 5. パフォーマンスチェック

- [ ] 36個の全ジョブが表示される
- [ ] スクロールがスムーズ
- [ ] Popoverの開閉が遅延なく動作

---

## テストデータの準備

### 開発環境でシードデータを投入

```javascript
// ブラウザコンソールで実行
window.seedService.reseedAll()
```

### 手動でテストユーザーを作成

```javascript
// レベルを変更
// (ユーザーサービス経由で更新)

// 能力値を変更
// (習慣達成で自然に上昇)

// ジョブを解放
// (条件を満たすと自動で解放される仕組みを確認)
```

---

## 期待される結果

### 成功基準

1. ✅ 未解放ジョブに進捗バッジが表示される
2. ✅ Popoverで各条件の詳細が表示される
3. ✅ プログレスバーが正しく動作する
4. ✅ 達成済み/未達成の視覚的区別が明確
5. ✅ 全体進捗が正しく計算される
6. ✅ TypeScriptエラーがない
7. ✅ 既存機能が壊れていない

---

## トラブルシューティング

### 進捗バッジが表示されない
- `job.progress` が undefined でないか確認
- `checkJobRequirements()` が正しく呼ばれているか確認

### プログレスバーが表示されない
- `job.requirementResults` が空でないか確認
- CSS クラスが正しく適用されているか確認

### 条件が正しく判定されない
- `jobRequirements.ts` のロジックを確認
- ユーザーデータが正しく渡されているか確認

---

## 次のステップ

テスト完了後:

1. スクリーンショットを撮影
2. 動作動画を録画 (オプション)
3. Issue #27 にテスト結果を報告
4. Pull Request を作成
