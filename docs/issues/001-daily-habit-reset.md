# Issue: 習慣の日次リセット機能

## タイトル
習慣の完了状態を日次でリセットする機能の実装

## 概要
現在、一度作成した習慣が翌日になっても「完了済み」状態のままとなっており、日々の習慣トラッキングとして機能していない。毎日0時（ユーザーのタイムゾーン基準）に習慣の完了状態がリセットされ、新しい日として再度記録できるようにする必要がある。

## 現状の問題
1. 習慣を完了としてマークすると、次の日もその状態が維持される
2. ユーザーは毎日同じ習慣を「完了」として記録することができない
3. 日次のストリーク計算が正確に機能しない可能性がある

## 期待される動作
1. 毎日0時（ユーザーのタイムゾーン設定に基づく）に習慣の「今日の完了状態」がリセットされる
2. リセット後、ユーザーは再度その日の習慣を完了としてマークできる
3. 過去の完了記録（HabitRecord）は保持される
4. ストリークは正確に計算される（連続日数のカウント）

## 技術的な考慮事項

### アプローチ案

#### 案1: フロントエンド側での日付チェック（推奨）
- フロントエンドで現在の日付を確認し、その日のHabitRecordが存在するかをチェック
- HabitRecordが存在しない = 未完了として表示
- HabitRecordが存在する = 完了として表示
- **メリット**: バックエンドの変更が最小限、リアルタイムでの反映
- **デメリット**: クライアント側でのロジックが増える

#### 案2: スケジュールされたLambda関数
- AWS EventBridgeで毎日0時にLambda関数を実行
- 各ユーザーのタイムゾーンを考慮してリセット処理
- **メリット**: サーバー側で一元管理
- **デメリット**: タイムゾーン処理が複雑、コスト増加

#### 案3: アクセス時のリセットチェック
- ユーザーがアプリにアクセスした際に前回アクセス日をチェック
- 日付が変わっていれば表示状態をリセット
- **メリット**: シンプルな実装
- **デメリット**: 日をまたいでアプリを開きっぱなしの場合に対応できない

### 推奨実装（案1ベース）

1. **フロントエンドの変更** (`frontend/src/services/habit.ts`)
   - `isCompletedToday(habitId, userId)` 関数を追加
   - 今日の日付のHabitRecordが存在するかチェック

2. **Dashboard/HabitCard の変更**
   - 習慣表示時に今日の完了状態を動的にチェック
   - `lastCompletedAt` ではなく、今日のHabitRecordの有無で判定

3. **ストリーク計算の修正** (`amplify/functions/record-habit/handler.ts`)
   - 前日のHabitRecordが存在するかチェック
   - 存在しない場合はストリークをリセット（1に戻す）

## 関連ファイル
- `frontend/src/services/habit.ts` - 習慣サービス
- `frontend/src/components/HabitCard.tsx` - 習慣カード表示
- `frontend/src/pages/Dashboard.tsx` - ダッシュボード
- `amplify/functions/record-habit/handler.ts` - 記録処理Lambda
- `amplify/data/resource.ts` - データスキーマ

## タスク分解
- [ ] 今日の完了状態をチェックする関数の実装
- [ ] HabitCardコンポーネントの完了状態表示ロジック修正
- [ ] ストリーク計算ロジックの修正（連続日でない場合のリセット）
- [ ] ユーザーのタイムゾーン対応
- [ ] ユニットテストの追加
- [ ] E2Eテストの追加

## 受け入れ条件
1. 習慣を完了した翌日、その習慣は「未完了」状態で表示される
2. 過去の完了記録は保持され、履歴から確認できる
3. 連続して完了した場合、ストリークが正しくカウントされる
4. 1日以上空いた場合、ストリークが1にリセットされる
5. ユーザーのタイムゾーン設定に基づいて日付が判定される

## 優先度
高（コア機能のため）

## ラベル
- enhancement
- frontend
- backend
- priority: high
